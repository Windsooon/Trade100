# Trading Analysis 功能测试指南

## 快速开始

### 1. 环境准备

确保已安装依赖：
```bash
npm install
```

### 2. 配置环境变量（可选）

如果需要使用 Dome API（当前功能可以工作，但如果有 API Key 会更好）：

创建或更新 `.env.local` 文件：
```bash
# Dome API Key (可选，免费层也可以使用)
DOME_API_KEY=your_api_key_here

# 如果需要代理
ALL_PROXY=http://127.0.0.1:9988
```

**注意**：Dome API 免费层支持 1 QPS，即使没有 API Key 也可以使用。

### 3. 启动开发服务器

使用代理（如果需要）：
```bash
export ALL_PROXY=http://127.0.0.1:9988 && npm run dev
```

或者直接启动：
```bash
npm run dev
```

服务器将在 [http://localhost:3000](http://localhost:3000) 启动

## 测试步骤

### 步骤 1: 访问 Trading Analysis 页面

1. 打开浏览器访问 `http://localhost:3000`
2. 点击导航栏中的 **"Analysis"** 链接
3. 或者直接访问 `http://localhost:3000/trading-analysis`

### 步骤 2: 添加钱包地址

1. 点击页面右上角的 **"Manage Wallets"** 按钮
2. 在对话框中输入一个有效的 Ethereum 钱包地址（例如：`0x7c3db723f1d4d8cb9c550095203b686cb11e5c6b`）
3. （可选）输入别名，如 "My Main Wallet"
4. 点击 **"Add Wallet"**
5. 钱包将被添加到列表并自动启用

**测试用例**：
- ✅ 添加有效地址：`0x7c3db723f1d4d8cb9c550095203b686cb11e5c6b`
- ❌ 添加无效地址：`invalid-address` （应该显示错误）
- ✅ 添加多个钱包地址
- ✅ 为钱包设置别名
- ✅ 启用/禁用钱包

### 步骤 3: 查看交易分析数据

添加钱包后，页面会自动加载：

1. **总体统计卡片**（顶部4个卡片）：
   - Total P/L（总盈亏）
   - Total Trades（总交易数）
   - Winning Trades（盈利交易数）
   - Losing Trades（亏损交易数）

2. **交易行为分析卡片**：
   - Daily Trades（日均交易次数）
   - Avg Holding Time（平均持仓时间）
   - Buy/Sell Ratio（买卖比例）
   - Win Rate（胜率）

3. **市场汇总网格**：
   - 显示所有有交易活动的市场
   - 每个市场卡片显示：
     - 市场标题
     - 总盈亏（带颜色标识）
     - 已实现/未实现盈亏
     - 交易次数
     - 当前持仓
     - 买入/卖出数量

### 步骤 4: 测试自动刷新

1. 页面默认每 10 秒自动刷新数据
2. 可以在 "Market Analysis" 卡片右上角看到 "Auto Refresh (10s)" 复选框
3. 取消勾选可以关闭自动刷新
4. 关闭自动刷新后，可以点击 "Refresh" 按钮手动刷新

**测试用例**：
- ✅ 自动刷新正常工作（每10秒更新一次）
- ✅ 可以关闭自动刷新
- ✅ 手动刷新按钮工作正常
- ✅ 设置会保存到 localStorage

### 步骤 5: 测试多钱包聚合

1. 添加第二个钱包地址
2. 确保两个钱包都启用
3. 观察数据是否聚合显示：
   - 总体统计应该包含两个钱包的总和
   - 市场汇总应该合并相同市场的交易

**测试用例**：
- ✅ 多个钱包的数据正确聚合
- ✅ 相同市场的交易正确合并
- ✅ 禁用某个钱包后，数据正确更新

### 步骤 6: 测试限流器

由于 Dome API 限制为 1 QPS，可以观察：

1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签
3. 添加钱包或刷新数据
4. 观察 API 请求：
   - 请求应该按顺序执行
   - 每个请求之间至少间隔 1 秒

**验证方法**：
- 查看 Network 标签中的请求时间戳
- 多个钱包查询时，请求应该串行执行

## 常见问题排查

### 问题 1: 页面显示 "No wallets enabled"

**解决方案**：
- 确保已添加至少一个钱包地址
- 确保钱包的 "Enabled" 复选框已勾选

### 问题 2: 数据加载很慢

**原因**：
- Dome API 免费层限制为 1 QPS（每秒1个请求）
- 如果钱包有大量交易历史，需要多次分页请求

**解决方案**：
- 这是正常现象，请耐心等待
- 可以考虑升级到 Dome API Dev 层（100 QPS）

### 问题 3: API 请求失败

**可能原因**：
- Dome API 服务不可用
- 网络连接问题
- 需要代理但未配置

**解决方案**：
- 检查网络连接
- 如果在中国，确保配置了代理：`export ALL_PROXY=http://127.0.0.1:9988`
- 查看浏览器控制台的错误信息

### 问题 4: 钱包地址验证失败

**原因**：
- 地址格式不正确
- 地址已存在

**解决方案**：
- 确保地址格式为：`0x` 开头，42 个字符
- 检查是否已添加过该地址

## 测试数据建议

### 测试钱包地址

可以使用以下真实钱包地址进行测试（这些地址在 Polymarket 上有交易记录）：

1. `0x7c3db723f1d4d8cb9c550095203b686cb11e5c6b`
2. `0xfd9c3e7f8c56eb4186372f343c873cce154b3873`

**注意**：使用真实地址时，数据加载可能需要一些时间，因为需要获取完整的交易历史。

## 性能测试

### 测试场景

1. **单钱包测试**：
   - 添加一个钱包
   - 观察加载时间
   - 预期：1-3秒（取决于交易数量）

2. **多钱包测试**：
   - 添加3个钱包
   - 观察聚合查询时间
   - 预期：3-10秒（由于限流器，请求串行执行）

3. **自动刷新测试**：
   - 启用自动刷新
   - 观察每10秒是否自动更新
   - 预期：数据自动刷新，无错误

## 浏览器控制台检查

打开浏览器开发者工具（F12），检查：

1. **Console 标签**：
   - 不应该有红色错误
   - 可能有警告（可以忽略）

2. **Network 标签**：
   - API 请求应该返回 200 状态码
   - 请求 URL 应该包含 `/api/trading/` 路径

3. **Application 标签**：
   - Local Storage 中应该有 `wallet_addresses` 键
   - 应该有 `trading_analysis_auto_refresh` 键

## 下一步

测试完成后，可以：

1. 查看代码实现细节
2. 根据需要调整 UI 样式
3. 添加更多功能（如交易记录表格、市场详情视图等）
4. 优化性能（如添加请求缓存、优化查询策略等）
